import "FungibleToken"
import "NonFungibleToken"

import "EVM"

import "FlowEVMBridgeUtils"

/// This contract serves Cadence code from chunked templates, replacing the contract name with the name derived from
/// given arguments - either Cadence Type or EVM contract address.
///
access(all) contract FlowEVMBridgeTemplates {
    /// Canonical path for the Admin resource
    access(all) let AdminStoragePath: StoragePath
    /// Chunked Hex-encoded Cadence contract code, to be joined on derived contract name
    access(self) let templateCodeChunks: {String: [String]}

    /// Serves bridged asset contract code for a given type, deriving the contract name from the EVM contract info
    access(all) fun getBridgedAssetContractCode(evmContractAddress: EVM.EVMAddress, isERC721: Bool): [UInt8]? {
        let cadenceContractName: String = isERC721 ?
            FlowEVMBridgeUtils.deriveBridgedNFTContractName(from: evmContractAddress) :
            FlowEVMBridgeUtils.deriveBridgedTokenContractName(from: evmContractAddress)

        if isERC721 {
            return self.getBridgedNFTContractCode(contractName: cadenceContractName)
        } else {
            // TODO
            return nil
        }
    }

    access(self) fun getBridgedNFTContractCode(contractName: String): [UInt8]? {
        return self.joinChunks(self.templateCodeChunks["bridgedNFT"]!, with: String.encodeHex(contractName.utf8))
    }

    access(self) fun joinChunks(_ chunks: [String], with name: String): [UInt8] {
        let nameBytes: [UInt8] = name.decodeHex()
        let code: [UInt8] = []
        for i, chunk in chunks {
            code.appendAll(chunk.decodeHex())
            // No need to append the contract name after the last chunk
            if i == chunks.length - 1 {
                break
            }
            code.appendAll(nameBytes)
        }
        return code
    }

    /// Resource enabling updates to the contract template code
    access(all) resource Admin {
        access(all) fun upsertContractCodeChunks(forTemplate: String, chunks: [String]) {
            FlowEVMBridgeTemplates.templateCodeChunks[forTemplate] = chunks
        }
        access(all) fun addNewContractCodeChunks(newTemplate: String, chunks: [String]) {
            pre {
                FlowEVMBridgeTemplates.templateCodeChunks[newTemplate] == nil: "Code already exists for template"
            }
            FlowEVMBridgeTemplates.templateCodeChunks[newTemplate] = chunks
        }
    }


    // Flow CLI currently breaks flow.json on [String] in contract init - hard coding for the time being but needs new
    // hex on template changes
    // init(templateCodeChunks: {String: [String]}) {
    init() {
        self.AdminStoragePath = /storage/flowEVMBridgeTemplatesAdmin
        self.templateCodeChunks = {}
        self.templateCodeChunks["bridgedNFT"] = [
            "696d706f7274204e6f6e46756e6769626c65546f6b656e2066726f6d203078663864366530353836623061323063370a696d706f7274204d6574616461746156696577732066726f6d203078663864366530353836623061323063370a696d706f727420566965775265736f6c7665722066726f6d203078663864366530353836623061323063370a696d706f72742046756e6769626c65546f6b656e2066726f6d203078656538323835366266323065326161360a696d706f727420466c6f77546f6b656e2066726f6d203078306165353363623665336634326137390a0a696d706f72742045564d2066726f6d203078663864366530353836623061323063370a0a696d706f72742049466c6f7745564d4e46544272696467652066726f6d203078663864366530353836623061323063370a696d706f7274204945564d4272696467654e46544c6f636b65722066726f6d203078663864366530353836623061323063370a696d706f727420466c6f7745564d427269646765436f6e6669672066726f6d203078663864366530353836623061323063370a696d706f727420466c6f7745564d4272696467655574696c732066726f6d203078663864366530353836623061323063370a696d706f727420466c6f7745564d4272696467652066726f6d203078663864366530353836623061323063370a696d706f7274204943726f7373564d2066726f6d203078663864366530353836623061323063370a696d706f72742043726f7373564d4e46542066726f6d203078663864366530353836623061323063370a0a2f2f2f205468697320636f6e747261637420697320612074656d706c617465207573656420627920466c6f7745564d42726964676520746f20646566696e652045564d2d6e6174697665204e46547320627269646765642066726f6d20466c6f772045564d20746f20466c6f772e0a2f2f2f2055706f6e206465706c6f796d656e74206f66207468697320636f6e74726163742c2074686520636f6e7472616374206e616d65206973206465726976656420617320612066756e6374696f6e206f6620746865206173736574207479706520286865726520616e2045524337323120616b610a2f2f2f20616e204e46542920616e642074686520636f6e747261637427732045564d20616464726573732e20546865206465726976656420636f6e7472616374206e616d65206973207468656e206a6f696e65642077697468207468697320636f6e7472616374277320636f64652c200a2f2f2f207072657061726564206173206368756e6b7320696e20466c6f7745564d42726964676554656d706c61746573206265666f7265206265696e67206465706c6f79656420746f2074686520466c6f772045564d20427269646765206163636f756e742e0a2f2f2f0a2f2f2f204f6e206272696467696e672c2074686520455243373231206973207472616e7366657272656420746f2074686520627269646765277320436164656e63654f776e65644163636f756e742045564d206164647265737320616e642061206e6577204e4654206973206d696e7465642066726f6d0a2f2f2f207468697320636f6e747261637420746f20746865206272696467696e672063616c6c65722e204f6e2072657475726e20746f20466c6f772045564d2c2074686520726576657273652070726f6365737320697320666f6c6c6f776564202d2074686520746f6b656e206973206275726e65640a2f2f2f20696e207468697320636f6e747261637420616e642074686520455243373231206973207472616e7366657272656420746f2074686520646566696e656420726563697069656e742e20496e2074686973207761792c2074686520436164656e636520746f6b656e206163747320617320610a2f2f2f20726570726573656e746174696f6e206f6620626f7468207468652045564d204e465420616e642074687573206f776e6572736869702072696768747320746f2069742075706f6e206272696467696e67206261636b20746f20466c6f772045564d2e0a2f2f2f0a2f2f2f20546f20627269646765206265747765656e20564d732c20612063616c6c65722063616e20656974686572207573652074686520636f6e7472616374206d6574686f647320646566696e65642062656c6f772c206f72207573652074686520466c6f7745564d42726964676527730a2f2f2f206272696467696e67206d6574686f64732077686963682077696c6c2070726f6772616d61746963616c6c7920726f757465206272696467696e672063616c6c7320746f207468697320636f6e74726163742e0a2f2f2f0a61636365737328616c6c2920636f6e747261637420",
            "3a204943726f7373564d2c2049466c6f7745564d4e46544272696467652c204945564d4272696467654e46544c6f636b65722c20566965775265736f6c766572207b0a0a202020202f2f2f20506f696e74657220746f2074686520466163746f7279206465706c6f79656420536f6c696469747920636f6e7472616374206164647265737320646566696e696e672074686520627269646765642061737365740a2020202061636365737328616c6c29206c65742065766d4e4654436f6e7472616374416464726573733a2045564d2e45564d416464726573730a202020202f2f2f20506f696e74657220746f2074686520466c6f77204e465420636f6e7472616374206164647265737320646566696e696e672074686520627269646765642061737365742c207468697320636f6e7472616374206164647265737320696e207468697320636173650a2020202061636365737328616c6c29206c657420666c6f774e4654436f6e7472616374416464726573733a20416464726573730a202020202f2f2f204e616d65206f6620746865204e465420636f6c6c656374696f6e20646566696e656420696e2074686520636f72726573706f6e64696e672045524337323120636f6e74726163740a2020202061636365737328616c6c29206c6574206e616d653a20537472696e670a202020202f2f2f2053796d626f6c206f6620746865204e465420636f6c6c656374696f6e20646566696e656420696e2074686520636f72726573706f6e64696e672045524337323120636f6e74726163740a2020202061636365737328616c6c29206c65742073796d626f6c3a20537472696e670a202020202f2f2f2054797065206f66204e4654206c6f636b656420696e2074686520636f6e74726163740a2020202061636365737328616c6c29206c6574206c6f636b65644e4654547970653a20547970650a202020202f2f2f205265736f7572636520776869636820686f6c6473206c6f636b6564204e4654730a2020202061636365737328636f6e747261637429206c6574206c6f636b65723a20407b43726f7373564d4e46542e45564d4e4654436f6c6c656374696f6e2c204e6f6e46756e6769626c65546f6b656e2e436f6c6c656374696f6e7d0a0a202020202f2f2f2057652063686f6f736520746865206e616d65204e465420686572652c20627574207468697320747970652063616e206861766520616e79206e616d65206e6f770a202020202f2f2f20626563617573652074686520696e7465726661636520646f6573206e6f74207265717569726520697420746f20686176652061207370656369666963206e616d6520616e79206d6f72650a2020202061636365737328616c6c29207265736f75726365204e46543a2043726f7373564d4e46542e45564d4e4654207b0a0a202020202020202061636365737328616c6c29206c65742069643a2055496e7436340a202020202020202061636365737328616c6c29206c65742065766d49443a2055496e743235360a202020202020202061636365737328616c6c29206c6574206e616d653a20537472696e670a202020202020202061636365737328616c6c29206c65742073796d626f6c3a20537472696e670a0a202020202020202061636365737328616c6c29206c6574207572693a20537472696e670a202020202020202061636365737328616c6c29206c6574206d657461646174613a207b537472696e673a20416e795374727563747d0a0a2020202020202020696e6974280a2020202020202020202020206e616d653a20537472696e672c0a20202020202020202020202073796d626f6c3a20537472696e672c0a20202020202020202020202065766d49443a2055496e743235362c0a2020202020202020202020207572693a20537472696e672c0a2020202020202020202020206d657461646174613a207b537472696e673a20416e795374727563747d0a202020202020202029207b0a20202020202020202020202073656c662e6e616d65203d206e616d650a20202020202020202020202073656c662e73796d626f6c203d2073796d626f6c0a20202020202020202020202073656c662e6964203d2073656c662e757569640a20202020202020202020202073656c662e65766d4944203d2065766d49440a20202020202020202020202073656c662e757269203d207572690a20202020202020202020202073656c662e6d65746164617461203d206d657461646174610a20202020202020207d0a0a20202020202020202f2f2f2052657475726e7320746865206964206f6620746865204e46540a202020202020202061636365737328616c6c2920766965772066756e20676574494428293a2055496e743634207b0a20202020202020202020202072657475726e2073656c662e69640a20202020202020207d0a0a20202020202020202f2f2f2052657475726e7320746865206d65746164617461207669657720747970657320737570706f727465642062792074686973204e46540a202020202020202061636365737328616c6c2920766965772066756e20676574566965777328293a205b547970655d207b0a20202020202020202020202072657475726e205b0a20202020202020202020202020202020547970653c4d6574616461746156696577732e446973706c61793e28292c0a20202020202020202020202020202020547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446174613e28292c0a20202020202020202020202020202020547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446973706c61793e28292c0a20202020202020202020202020202020547970653c4d6574616461746156696577732e53657269616c3e28290a2020202020202020202020205d0a20202020202020207d0a0a20202020202020202f2f2f205265736f6c7665732061206d65746164617461207669657720666f722074686973204e46540a202020202020202061636365737328616c6c292066756e207265736f6c766556696577285f20766965773a2054797065293a20416e795374727563743f207b0a2020202020202020202020207377697463682076696577207b0a202020202020202020202020202020202f2f20576520646f6e2774206b6e6f772077686174206b696e64206f662066696c65207468652055524920726570726573656e747320284950465320762048545450292c20736f2077652063616e2774207265736f6c766520446973706c617920766965770a202020202020202020202020202020202f2f20776974682074686520555249206173207468756d626e61696c202d207765206d61792061206e6577207374616e64617264207669657720666f722045564d204e465473202d207468697320697320696e746572696d0a202020202020202020202020202020206361736520547970653c43726f7373564d4e46542e427269646765644d657461646174613e28293a0a202020202020202020202020202020202020202072657475726e2043726f7373564d4e46542e427269646765644d65746164617461280a2020202020202020202020202020202020202020202020206e616d653a2073656c662e6e616d652c0a20202020202020202020202020202020202020202020202073796d626f6c3a2073656c662e73796d626f6c2c0a2020202020202020202020202020202020202020202020207572693a2043726f7373564d4e46542e5552492873656c662e757269292c0a20202020202020202020202020202020202020202020202065766d436f6e7472616374416464726573733a2073656c662e67657445564d436f6e74726163744164647265737328290a2020202020202020202020202020202020202020290a202020202020202020202020202020206361736520547970653c4d6574616461746156696577732e53657269616c3e28293a0a202020202020202020202020202020202020202072657475726e204d6574616461746156696577732e53657269616c280a20202020202020202020202020202020202020202020202073656c662e69640a2020202020202020202020202020202020202020290a202020202020202020202020202020206361736520547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446174613e28293a0a202020202020202020202020202020202020202072657475726e20",
            "2e676574436f6c6c656374696f6e44617461286e6674547970653a20547970653c40",
            "2e4e46543e2829290a202020202020202020202020202020206361736520547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446973706c61793e28293a0a202020202020202020202020202020202020202072657475726e20",
            "2e676574436f6c6c656374696f6e446973706c6179286e6674547970653a20547970653c40",
            "2e4e46543e2829290a2020202020202020202020207d0a20202020202020202020202072657475726e206e696c0a20202020202020207d0a0a20202020202020202f2f2f207075626c69632066756e6374696f6e207468617420616e796f6e652063616e2063616c6c20746f206372656174652061206e657720656d70747920636f6c6c656374696f6e0a202020202020202061636365737328616c6c292066756e20637265617465456d707479436f6c6c656374696f6e28293a20407b4e6f6e46756e6769626c65546f6b656e2e436f6c6c656374696f6e7d207b0a20202020202020202020202072657475726e203c2d2063726561746520",
            "2e436f6c6c656374696f6e28290a20202020202020207d0a0a20202020202020202f2a202d2d2d2043726f7373564d4e465420636f6e666f726d616e6365202d2d2d202a2f0a20202020202020202f2f0a20202020202020202f2f2f2052657475726e73207468652045564d20636f6e74726163742061646472657373206f6620746865204e46540a202020202020202061636365737328616c6c292066756e2067657445564d436f6e74726163744164647265737328293a2045564d2e45564d41646472657373207b0a20202020202020202020202072657475726e20",
            "2e67657445564d436f6e74726163744164647265737328290a20202020202020207d0a0a20202020202020202f2f2f2053696d696c617220746f204552433732312e746f6b656e555249206d6574686f642c2072657475726e732074686520555249206f6620746865204e465420776974682073656c662e65766d49442061742074696d65206f66206272696467696e670a202020202020202061636365737328616c6c292066756e20746f6b656e55524928293a20537472696e67207b0a20202020202020202020202072657475726e2073656c662e7572690a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732074686520466c6f772041646472657373206f66207468652064656661756c742062726964676520757365642062792074686973204e4654277320636f6e74726163740a202020202020202061636365737328616c6c2920766965772066756e2067657444656661756c744272696467654164647265737328293a2041646472657373207b0a20202020202020202020202072657475726e203078663864366530353836623061323063370a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732061207265666572656e636520746f206120636f6e7472616374206173206026416e79537472756374602e205468697320656e61626c65732074686520726573756c7420746f20626520636173742061732061206272696467696e670a20202020202020202f2f2f20636f6e7472616374206279207468652063616c6c657220616e642061766f6964732063697263756c617220646570656e64656e637920696e2074686520696d706c656d656e74696e6720636f6e74726163740a202020202020202061636365737328616c6c2920766965772066756e20626f72726f7744656661756c74427269646765436f6e747261637428293a2026416e79537472756374207b0a20202020202020202020202072657475726e2026",
            "0a20202020202020207d0a202020207d0a0a2020202061636365737328616c6c29207265736f7572636520436f6c6c656374696f6e3a204e6f6e46756e6769626c65546f6b656e2e436f6c6c656374696f6e2c2043726f7373564d4e46542e45564d42726964676561626c65436f6c6c656374696f6e207b0a20202020202020202f2f2f2064696374696f6e617279206f66204e465420636f6e666f726d696e6720746f6b656e7320696e6465786564206f6e2074686569722049440a202020202020202061636365737328636f6e74726163742920766172206f776e65644e4654733a20407b55496e7436343a20",
            "2e4e46547d0a20202020202020202f2f2f204d617070696e67206f662045564d2049447320746f20466c6f77204e4654204944730a202020202020202061636365737328636f6e747261637429206c65742065766d4944546f466c6f7749443a207b55496e743235363a2055496e7436347d0a0a20202020202020206163636573732873656c6629207661722073746f72616765506174683a2053746f72616765506174680a20202020202020206163636573732873656c662920766172207075626c6963506174683a205075626c6963506174680a0a20202020202020202f2f2f2052657475726e207468652064656661756c742073746f72616765207061746820666f722074686520636f6c6c656374696f6e0a202020202020202061636365737328616c6c2920766965772066756e2067657444656661756c7453746f726167655061746828293a2053746f72616765506174683f207b0a20202020202020202020202072657475726e2073656c662e73746f72616765506174680a20202020202020207d0a0a20202020202020202f2f2f2052657475726e207468652064656661756c74207075626c6963207061746820666f722074686520636f6c6c656374696f6e0a202020202020202061636365737328616c6c2920766965772066756e2067657444656661756c745075626c69635061746828293a205075626c6963506174683f207b0a20202020202020202020202072657475726e2073656c662e7075626c6963506174680a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732074686520466c6f772041646472657373206f66207468652064656661756c74206272696467652075736564206279207468697320436f6c6c656374696f6e277320636f6e74726163740a202020202020202061636365737328616c6c2920766965772066756e2067657444656661756c744272696467654164647265737328293a2041646472657373207b0a20202020202020202020202072657475726e203078663864366530353836623061323063370a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732061207265666572656e636520746f206120636f6e7472616374206173206026416e79537472756374602e205468697320656e61626c65732074686520726573756c7420746f20626520636173742061732061206272696467696e670a20202020202020202f2f2f20636f6e7472616374206279207468652063616c6c657220616e642061766f6964732063697263756c617220646570656e64656e637920696e2074686520696d706c656d656e74696e6720636f6e74726163740a202020202020202061636365737328616c6c2920766965772066756e20626f72726f7744656661756c74427269646765436f6e747261637428293a2026416e79537472756374207b0a20202020202020202020202072657475726e2026",
            "0a20202020202020207d0a0a2020202020202020696e6974202829207b0a20202020202020202020202073656c662e6f776e65644e465473203c2d207b7d0a20202020202020202020202073656c662e65766d4944546f466c6f774944203d207b7d0a2020202020202020202020206c6574206964656e746966696572203d2022",
            "436f6c6c656374696f6e220a20202020202020202020202073656c662e73746f7261676550617468203d2053746f7261676550617468286964656e7469666965723a206964656e74696669657229210a20202020202020202020202073656c662e7075626c696350617468203d205075626c696350617468286964656e7469666965723a206964656e74696669657229210a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732061206c697374206f66204e46542074797065732074686174207468697320726563656976657220616363657074730a202020202020202061636365737328616c6c2920766965772066756e20676574537570706f727465644e4654547970657328293a207b547970653a20426f6f6c7d207b0a20202020202020202020202072657475726e207b20547970653c40",
            "2e4e46543e28293a2074727565207d0a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732077686574686572206f72206e6f742074686520676976656e20747970652069732061636365707465642062792074686520636f6c6c656374696f6e0a20202020202020202f2f2f204120636f6c6c656374696f6e20746861742063616e2061636365707420616e7920747970652073686f756c64206a7573742072657475726e20747275652062792064656661756c740a202020202020202061636365737328616c6c2920766965772066756e206973537570706f727465644e46545479706528747970653a2054797065293a20426f6f6c207b0a202020202020202020202072657475726e2074797065203d3d20547970653c40",
            "2e4e46543e28290a20202020202020207d0a0a20202020202020202f2f2f204272696467657320616e206f776e6564204e465420746f20466c6f772045564d0a20202020202020206163636573732843726f7373564d4e46542e42726964676561626c65292066756e20627269646765546f45564d2869643a2055496e7436342c20746f3a2045564d2e45564d416464726573732c20746f6c6c4665653a20407b46756e6769626c65546f6b656e2e5661756c747d29207b0a202020202020202020202020707265207b0a20202020202020202020202020202020746f6c6c4665652e676574547970652829203d3d20547970653c40466c6f77546f6b656e2e5661756c743e28293a2022546f6c6c20666565206d757374206265207061696420696e20466c6f77546f6b656e220a2020202020202020202020207d0a2020202020202020202020206c657420636173745661756c74203c2d20746f6c6c466565206173212040466c6f77546f6b656e2e5661756c740a2020202020202020202020206c657420746f6b656e203c2d2073656c662e776974686472617728776974686472617749443a206964290a202020202020202020202020",
            "2e6272696467654e4654546f45564d28746f6b656e3a203c2d746f6b656e2c20746f3a20746f2c20746f6c6c4665653a203c2d636173745661756c74290a20202020202020207d0a0a20202020202020202f2f2f2052656d6f76657320616e204e46542066726f6d2074686520636f6c6c656374696f6e20616e64206d6f76657320697420746f207468652063616c6c65720a2020202020202020616363657373284e6f6e46756e6769626c65546f6b656e2e576974686472617761626c65292066756e20776974686472617728776974686472617749443a2055496e743634293a20407b4e6f6e46756e6769626c65546f6b656e2e4e46547d207b0a2020202020202020202020206c657420746f6b656e203c2d2073656c662e6f776e65644e4654732e72656d6f7665286b65793a2077697468647261774944290a202020202020202020202020202020203f3f2070616e69632822436f756c64206e6f7420776974686472617720616e204e46542077697468207468652070726f76696465642049442066726f6d2074686520636f6c6c656374696f6e22290a0a20202020202020202020202072657475726e203c2d746f6b656e0a20202020202020207d0a0a20202020202020202f2f2f2057697468647261777320616e204e46542066726f6d2074686520636f6c6c656374696f6e206279206974732045564d2049440a2020202020202020616363657373284e6f6e46756e6769626c65546f6b656e2e576974686472617761626c65292066756e207769746864726177427945564d4944285f2069643a2055496e743634293a20407b4e6f6e46756e6769626c65546f6b656e2e4e46547d207b0a2020202020202020202020206c657420746f6b656e203c2d2073656c662e6f776e65644e4654732e72656d6f7665286b65793a206964290a202020202020202020202020202020203f3f2070616e69632822436f756c64206e6f7420776974686472617720616e204e46542077697468207468652070726f76696465642049442066726f6d2074686520636f6c6c656374696f6e22290a0a20202020202020202020202072657475726e203c2d746f6b656e0a20202020202020207d0a0a20202020202020202f2f2f205474616b65732061204e465420616e64206164647320697420746f2074686520636f6c6c656374696f6e732064696374696f6e61727920616e6420616464732074686520494420746f207468652065766d4944546f466c6f774944206d617070696e670a202020202020202061636365737328616c6c292066756e206465706f73697428746f6b656e3a20407b4e6f6e46756e6769626c65546f6b656e2e4e46547d29207b0a2020202020202020202020206c657420746f6b656e203c2d20746f6b656e206173212040",
            "2e4e46540a0a2020202020202020202020202f2f2061646420746865206e657720746f6b656e20746f207468652064696374696f6e6172792077686963682072656d6f76657320746865206f6c64206f6e650a20202020202020202020202073656c662e65766d4944546f466c6f7749445b746f6b656e2e65766d49445d203d20746f6b656e2e69640a2020202020202020202020206c6574206f6c64546f6b656e203c2d2073656c662e6f776e65644e4654735b746f6b656e2e69645d203c2d20746f6b656e0a0a20202020202020202020202064657374726f79206f6c64546f6b656e0a20202020202020207d0a0a20202020202020202f2f2f2052657475726e7320616e206172726179206f66207468652049447320746861742061726520696e2074686520636f6c6c656374696f6e0a202020202020202061636365737328616c6c2920766965772066756e2067657449447328293a205b55496e7436345d207b0a20202020202020202020202072657475726e2073656c662e6f776e65644e4654732e6b6579730a20202020202020207d0a0a20202020202020202f2f2f2052657475726e7320616e206172726179206f66207468652045564d2049447320746861742061726520696e2074686520636f6c6c656374696f6e0a202020202020202061636365737328616c6c2920766965772066756e2067657445564d49447328293a205b55496e743235365d207b0a20202020202020202020202072657475726e2073656c662e65766d4944546f466c6f7749442e6b6579730a20202020202020207d0a0a20202020202020202f2f2f2052657475726e732074686520666c6f77200a202020202020202061636365737328616c6c2920766965772066756e20676574466c6f7749442866726f6d2065766d49443a2055496e74323536293a2055496e7436343f207b0a20202020202020202020202072657475726e2073656c662e65766d4944546f466c6f7749445b65766d49445d0a20202020202020207d0a0a20202020202020202f2f2f20476574732074686520616d6f756e74206f66204e4654732073746f72656420696e2074686520636f6c6c656374696f6e0a202020202020202061636365737328616c6c2920766965772066756e206765744c656e67746828293a20496e74207b0a20202020202020202020202072657475726e2073656c662e6f776e65644e4654732e6b6579732e6c656e6774680a20202020202020207d0a0a20202020202020202f2f2f205265747269657665732061207265666572656e636520746f20746865204e46542073746f72656420696e2074686520636f6c6c656374696f6e206279206974732049440a202020202020202061636365737328616c6c2920766965772066756e20626f72726f774e4654285f2069643a2055496e743634293a20267b4e6f6e46756e6769626c65546f6b656e2e4e46547d3f207b0a20202020202020202020202072657475726e202673656c662e6f776e65644e4654735b69645d0a20202020202020207d0a0a20202020202020202f2f2f20426f72726f77207468652076696577207265736f6c76657220666f722074686520737065636966696564204e46542049440a202020202020202061636365737328616c6c2920766965772066756e20626f72726f77566965775265736f6c7665722869643a2055496e743634293a20267b566965775265736f6c7665722e5265736f6c7665727d3f207b0a2020202020202020202020206966206c6574206e6674203d202673656c662e6f776e65644e4654735b69645d2061732026",
            "2e4e46543f207b0a2020202020202020202020202020202072657475726e206e667420617320267b566965775265736f6c7665722e5265736f6c7665727d0a2020202020202020202020207d0a20202020202020202020202072657475726e206e696c0a20202020202020207d0a0a20202020202020202f2f2f204372656174657320616e20656d70747920636f6c6c656374696f6e0a202020202020202061636365737328616c6c292066756e20637265617465456d707479436f6c6c656374696f6e28293a20407b4e6f6e46756e6769626c65546f6b656e2e436f6c6c656374696f6e7d20207b0a20202020202020202020202072657475726e203c2d2063726561746520436f6c6c656374696f6e28290a20202020202020207d0a202020207d0a0a202020202f2f2f207075626c69632066756e6374696f6e207468617420616e796f6e652063616e2063616c6c20746f206372656174652061206e657720656d70747920636f6c6c656374696f6e0a202020202f2f2f2053696e6365206d756c7469706c6520636f6c6c656374696f6e2074797065732063616e20626520646566696e656420696e206120636f6e74726163742c0a202020202f2f2f205468652063616c6c6572206e6565647320746f2073706563696679207768696368206f6e6520746865792077616e7420746f206372656174650a2020202061636365737328616c6c292066756e20637265617465456d707479436f6c6c656374696f6e28293a2040",
            "2e436f6c6c656374696f6e207b0a202020202020202072657475726e203c2d2063726561746520436f6c6c656374696f6e28290a202020207d0a0a202020202f2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a0a202020202020202020202020476574746572730a202020202a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2f0a0a202020202f2f2f2046756e6374696f6e20746861742072657475726e7320616c6c20746865204d6574616461746120566965777320696d706c656d656e7465642062792061204e6f6e2046756e6769626c6520546f6b656e0a202020202f2f2f0a202020202f2f2f204072657475726e20416e206172726179206f6620547970657320646566696e696e672074686520696d706c656d656e7465642076696577732e20546869732076616c75652077696c6c20626520757365642062790a202020202f2f2f202020202020202020646576656c6f7065727320746f206b6e6f7720776869636820706172616d6574657220746f207061737320746f20746865207265736f6c7665566965772829206d6574686f642e0a202020202f2f2f0a2020202061636365737328616c6c2920766965772066756e20676574566965777328293a205b547970655d207b0a202020202020202072657475726e205b0a202020202020202020202020547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446174613e28292c0a202020202020202020202020547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446973706c61793e28290a20202020202020205d0a202020207d0a0a202020202f2f2f2046756e6374696f6e2074686174207265736f6c7665732061206d65746164617461207669657720666f72207468697320636f6e74726163742e0a202020202f2f2f0a202020202f2f2f2040706172616d20766965773a205468652054797065206f6620746865206465736972656420766965772e0a202020202f2f2f204072657475726e20412073747275637475726520726570726573656e74696e67207468652072657175657374656420766965772e0a202020202f2f2f0a2020202061636365737328616c6c292066756e207265736f6c766556696577285f20766965773a2054797065293a20416e795374727563743f207b0a20202020202020207377697463682076696577207b0a2020202020202020202020206361736520547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446174613e28293a0a2020202020202020202020202020202072657475726e20",
            "2e676574436f6c6c656374696f6e44617461286e6674547970653a20547970653c40",
            "2e4e46543e2829290a2020202020202020202020206361736520547970653c4d6574616461746156696577732e4e4654436f6c6c656374696f6e446973706c61793e28293a0a2020202020202020202020202020202072657475726e20",
            "2e676574436f6c6c656374696f6e446973706c6179286e6674547970653a20547970653c40",
            "2e4e46543e2829290a20202020202020207d0a202020202020202072657475726e206e696c0a202020207d0a0a202020202f2f2f207265736f6c76652061207479706520746f2069747320436f6c6c656374696f6e4461746120736f20796f75206b6e6f7720776865726520746f2073746f72652069740a202020202f2f2f2052657475726e7320606e696c60206966206e6f20636f6c6c656374696f6e20747970652065786973747320666f722074686520737065636966696564204e465420747970650a2020202061636365737328616c6c2920766965772066756e20676574436f6c6c656374696f6e44617461286e6674547970653a2054797065293a204d6574616461746156696577732e4e4654436f6c6c656374696f6e446174613f207b0a2020202020202020737769746368206e667454797065207b0a2020202020202020202020206361736520547970653c40",
            "2e4e46543e28293a0a202020202020202020202020202020206c657420636f6c6c656374696f6e526566203d2073656c662e6163636f756e742e73746f726167652e626f72726f773c26",
            "2e436f6c6c656374696f6e3e280a20202020202020202020202020202020202020202020202066726f6d3a202f73746f726167652f",
            "436f6c6c656374696f6e0a202020202020202020202020202020202020202029203f3f2070616e69632822436f756c64206e6f7420626f72726f772061207265666572656e636520746f207468652073746f72656420636f6c6c656374696f6e22290a202020202020202020202020202020206c657420636f6c6c656374696f6e44617461203d204d6574616461746156696577732e4e4654436f6c6c656374696f6e44617461280a202020202020202020202020202020202020202073746f72616765506174683a20636f6c6c656374696f6e5265662e67657444656661756c7453746f72616765506174682829212c0a20202020202020202020202020202020202020207075626c6963506174683a20636f6c6c656374696f6e5265662e67657444656661756c745075626c6963506174682829212c0a202020202020202020202020202020202020202070726f7669646572506174683a202f707269766174652f",
            "436f6c6c656374696f6e2c0a20202020202020202020202020202020202020207075626c6963436f6c6c656374696f6e3a20547970653c26",
            "2e436f6c6c656374696f6e3e28292c0a20202020202020202020202020202020202020207075626c69634c696e6b6564547970653a20547970653c26",
            "2e436f6c6c656374696f6e3e28292c0a202020202020202020202020202020202020202070726f76696465724c696e6b6564547970653a20547970653c61757468284e6f6e46756e6769626c65546f6b656e2e576974686472617761626c65292026",
            "2e436f6c6c656374696f6e3e28292c0a2020202020202020202020202020202020202020637265617465456d707479436f6c6c656374696f6e46756e6374696f6e3a202866756e28293a20407b4e6f6e46756e6769626c65546f6b656e2e436f6c6c656374696f6e7d207b0a20202020202020202020202020202020202020202020202072657475726e203c2d",
            "2e637265617465456d707479436f6c6c656374696f6e28290a20202020202020202020202020202020202020207d290a20202020202020202020202020202020290a2020202020202020202020202020202072657475726e20636f6c6c656374696f6e446174610a20202020202020202020202064656661756c743a0a2020202020202020202020202020202072657475726e206e696c0a20202020202020207d0a202020207d0a0a202020202f2f2f2052657475726e732074686520436f6c6c656374696f6e446973706c6179207669657720666f7220746865204e465420747970652074686174206973207370656369666965640a202020202f2f20544f444f3a205265706c61636520776974682067656e6572616c697a65642062726964676520636f6c6c656374696f6e20646973706c61790a2020202061636365737328616c6c2920766965772066756e20676574436f6c6c656374696f6e446973706c6179286e6674547970653a2054797065293a204d6574616461746156696577732e4e4654436f6c6c656374696f6e446973706c61793f207b0a2020202020202020737769746368206e667454797065207b0a2020202020202020202020206361736520547970653c40",
            "2e4e46543e28293a0a202020202020202020202020202020206c6574206d65646961203d204d6574616461746156696577732e4d65646961280a202020202020202020202020202020202020202066696c653a204d6574616461746156696577732e4854545046696c65280a20202020202020202020202020202020202020202020202075726c3a202268747470733a2f2f6173736574732e776562736974652d66696c65732e636f6d2f3566363239346330633761386364643634336231633832302f3566363239346330633761386364613535636231633933365f466c6f775f576f72646d61726b2e737667220a2020202020202020202020202020202020202020292c0a20202020202020202020202020202020202020206d65646961547970653a2022696d6167652f7376672b786d6c220a20202020202020202020202020202020290a2020202020202020202020202020202072657475726e204d6574616461746156696577732e4e4654436f6c6c656374696f6e446973706c6179280a20202020202020202020202020202020202020206e616d653a202254686520466c6f77564d2042726964676564204e465420436f6c6c656374696f6e222c0a20202020202020202020202020202020202020206465736372697074696f6e3a20225468697320636f6c6c656374696f6e2077617320627269646765642066726f6d20466c6f772045564d2e222c0a202020202020202020202020202020202020202065787465726e616c55524c3a204d6574616461746156696577732e45787465726e616c55524c282268747470733a2f2f6578616d706c652d6e66742e6f6e666c6f772e6f726722292c0a2020202020202020202020202020202020202020737175617265496d6167653a206d656469612c0a202020202020202020202020202020202020202062616e6e6572496d6167653a206d656469612c0a2020202020202020202020202020202020202020736f6369616c733a207b7d0a20202020202020202020202020202020290a20202020202020202020202064656661756c743a0a2020202020202020202020202020202072657475726e206e696c0a20202020202020207d0a202020207d0a0a202020202f2f2f2052657475726e73207468652045564d20636f6e74726163742061646472657373206f6620746865204e4654207468697320636f6e747261637420726570726573656e74730a202020202f2f2f0a2020202061636365737328616c6c292066756e2067657445564d436f6e74726163744164647265737328293a2045564d2e45564d41646472657373207b0a202020202020202072657475726e2073656c662e65766d4e4654436f6e7472616374416464726573730a202020207d0a0a202020202f2f2f2052657475726e732074686520616d6f756e74206f6620464c4f5720726571756972656420746f2062726964676520616e204e46540a202020202f2f2f0a2020202061636365737328616c6c2920766965772066756e20676574466565416d6f756e7428293a20554669783634207b0a202020202020202072657475726e20466c6f7745564d427269646765436f6e6669672e6272696467654665650a202020207d0a0a202020202f2f2f2052657475726e73207468652074797065206f662066756e6769626c6520746f6b656e732074686520627269646765206163636570747320666f7220666565730a202020202f2f2f0a2020202061636365737328616c6c2920766965772066756e206765744665655661756c745479706528293a2054797065207b0a202020202020202072657475726e20547970653c407b46756e6769626c65546f6b656e2e5661756c747d3e28290a202020207d0a0a202020202f2f2f2052657475726e732074686520636f756e74206f66204e465473206c6f636b6564206279207468697320636f6e74726163740a202020202f2f2f0a2020202061636365737328616c6c2920766965772066756e206765744c6f636b65644e4654436f756e7428293a20496e74207b0a202020202020202072657475726e2073656c662e6c6f636b65722e6765744c656e67746828290a202020207d0a0a202020202f2f2f2052657475726e732061207265666572656e636520746f2074686520676976656e204e4654206c6f636b6564206279207468697320636f6e7472616374207769746820746865207370656369666965642049440a202020202f2f2f0a2020202061636365737328616c6c2920766965772066756e20626f72726f774c6f636b65644e46542869643a2055496e743634293a20267b4e6f6e46756e6769626c65546f6b656e2e4e46547d3f207b0a202020202020202072657475726e2073656c662e6c6f636b65722e626f72726f774e4654286964290a202020207d0a0a202020202f2f2f2052657475726e73207768657468657220746865204e465420776974682074686520737065636966696564204944206973206c6f636b6564206279207468697320636f6e74726163740a202020202f2f2f0a2020202061636365737328616c6c2920766965772066756e2069734c6f636b65642869643a2055496e743634293a20426f6f6c207b0a202020202020202072657475726e2073656c662e6c6f636b65722e626f72726f774e46542869642920213d206e696c0a202020207d0a0a202020202f2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a0a2020202020202020417578696c696172792042726964676520456e747279706f696e74730a202020202a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2a2f0a0a202020202f2f2f20436f6d706c657465732074686520627269646765206f66207468697320636f6e74726163742773204e46542066726f6d20466c6f7720746f20466c6f772045564d0a202020202f2f2f0a2020202061636365737328616c6c292066756e206272696467654e4654546f45564d28746f6b656e3a20407b4e6f6e46756e6769626c65546f6b656e2e4e46547d2c20746f3a2045564d2e45564d416464726573732c20746f6c6c4665653a20407b46756e6769626c65546f6b656e2e5661756c747d29207b0a2020202020202020707265207b0a202020202020202020202020466c6f7745564d4272696467655574696c732e76616c69646174654665652826746f6c6c4665652c206f6e626f617264696e673a2066616c7365293a2022496e76616c6964206665652070616964220a20202020202020207d0a2020202020202020466c6f7745564d4272696467655574696c732e6465706f736974546f6c6c466565283c2d746f6c6c466565290a20202020202020206c65742063617374203c2d20746f6b656e206173212040",
            "2e4e46540a2020202020202020617373657274280a202020202020202020202020466c6f7745564d4272696467655574696c732e69734f776e65724f72417070726f766564280a202020202020202020202020202020206f664e46543a20636173742e65766d49442c0a202020202020202020202020202020206f776e65723a20466c6f7745564d4272696467652e676574427269646765434f4145564d4164647265737328292c0a2020202020202020202020202020202065766d436f6e7472616374416464726573733a2073656c662e67657445564d436f6e74726163744164647265737328290a202020202020202020202020292c206d6573736167653a202254686520726571756573746564204e4654206973206e6f74206f776e6564206279207468652062726964676520434f41206163636f756e74220a2020202020202020290a0a2020202020202020466c6f7745564d4272696467655574696c732e63616c6c280a2020202020202020202020207369676e61747572653a2022736166655472616e7366657246726f6d28616464726573732c616464726573732c75696e7432353629222c0a20202020202020202020202074617267657445564d416464726573733a2073656c662e65766d4e4654436f6e7472616374416464726573732c0a202020202020202020202020617267733a205b466c6f7745564d4272696467652e676574427269646765434f4145564d4164647265737328292c20746f2c20636173742e65766d49445d2c0a2020202020202020202020206761734c696d69743a2031353030303030302c0a20202020202020202020202076616c75653a20302e300a2020202020202020290a0a20202020202020202f2f2073656c662e6275726e4e4654286e66743a203c2d63617374290a202020202020202073656c662e6c6f636b65722e6465706f73697428746f6b656e3a203c2d63617374290a202020207d0a0a202020202f2f2f20436f6d706c657465732074686520627269646765206f66207468697320636f6e74726163742773204e46542066726f6d20466c6f772045564d20746f20466c6f770a202020202f2f2f0a2020202061636365737328616c6c292066756e206272696467654e465446726f6d45564d280a202020202020202063616c6c65723a202645564d2e427269646765644163636f756e742c0a202020202020202063616c6c646174613a205b55496e74385d2c0a202020202020202069643a2055496e743235362c0a202020202020202065766d436f6e7472616374416464726573733a2045564d2e45564d416464726573732c0a2020202020202020746f6c6c4665653a20407b46756e6769626c65546f6b656e2e5661756c747d0a20202020293a20407b4e6f6e46756e6769626c65546f6b656e2e4e46547d207b0a2020202020202020707265207b0a20202020202020202020202073656c662e65766d4e4654436f6e7472616374416464726573732e6279746573203d3d2065766d436f6e7472616374416464726573732e62797465733a2022496e76616c69642045564d20636f6e74726163742061646472657373220a202020202020202020202020466c6f7745564d4272696467655574696c732e76616c69646174654665652826746f6c6c4665652c206f6e626f617264696e673a2066616c7365293a2022496e76616c6964206665652070616964220a20202020202020207d0a2020202020202020466c6f7745564d4272696467655574696c732e6465706f736974546f6c6c466565283c2d746f6c6c466565290a2020202020202020617373657274280a202020202020202020202020466c6f7745564d4272696467655574696c732e69734f776e65724f72417070726f766564280a202020202020202020202020202020206f664e46543a2069642c0a202020202020202020202020202020206f776e65723a2063616c6c65722e6164647265737328292c0a2020202020202020202020202020202065766d436f6e7472616374416464726573733a2065766d436f6e7472616374416464726573730a202020202020202020202020292c206d6573736167653a202243616c6c657220646f6573206e6f74206f776e20746865204e4654220a2020202020202020290a202020202020202063616c6c65722e63616c6c280a202020202020202020202020746f3a2065766d436f6e7472616374416464726573732c0a202020202020202020202020646174613a2063616c6c646174612c0a2020202020202020202020206761734c696d69743a2031353030303030302c0a20202020202020202020202076616c75653a2045564d2e42616c616e636528666c6f773a20302e30290a2020202020202020290a2020202020202020466c6f7745564d4272696467655574696c732e63616c6c280a2020202020202020202020207369676e61747572653a2022736166655472616e7366657246726f6d28616464726573732c616464726573732c75696e7432353629222c0a20202020202020202020202074617267657445564d416464726573733a2073656c662e65766d4e4654436f6e7472616374416464726573732c0a202020202020202020202020617267733a205b63616c6c65722e6164647265737328292c20466c6f7745564d4272696467652e676574427269646765434f4145564d4164647265737328292c2069645d2c0a2020202020202020202020206761734c696d69743a2031353030303030302c0a20202020202020202020202076616c75653a20302e300a2020202020202020290a2020202020202020617373657274280a202020202020202020202020466c6f7745564d4272696467655574696c732e69734f776e65724f72417070726f766564280a202020202020202020202020202020206f664e46543a2069642c0a202020202020202020202020202020206f776e65723a20466c6f7745564d4272696467652e676574427269646765434f4145564d4164647265737328292c0a2020202020202020202020202020202065766d436f6e7472616374416464726573733a2065766d436f6e7472616374416464726573730a202020202020202020202020292c206d6573736167653a20225472616e7366657220746f2042726964676520434f4120776173206e6f74207375636365737366756c220a2020202020202020290a20202020202020202f2f204e46542068617320616c7265616479206265656e206d696e74656420616e6420776173206c6f636b6564206f6e206272696467696e67206261636b20746f2045564d202d20776974686472617720262072657475726e0a20202020202020206966206c657420666c6f774944203d2073656c662e6c6f636b65722e676574466c6f7749442866726f6d3a20696429207b0a20202020202020202020202072657475726e203c2d2073656c662e6c6f636b65722e776974686472617728776974686472617749443a20666c6f774944290a20202020202020207d0a20202020202020202f2f204f74686572776973652c2074686973206973207468652066697273742074696d6520746865204e465420686173206265656e206272696467656420746f20466c6f77202d206d696e7420262072657475726e0a20202020202020206c657420746f6b656e555249526573706f6e73653a205b416e795374727563745d203d20280a20202020202020202020202045564d2e6465636f6465414249280a2020202020202020202020202020202074797065733a205b547970653c537472696e673e28295d2c0a20202020202020202020202020202020646174613a20466c6f7745564d4272696467655574696c732e63616c6c280a20202020202020202020202020202020202020207369676e61747572653a2022746f6b656e5552492875696e7432353629222c0a202020202020202020202020202020202020202074617267657445564d416464726573733a2073656c662e67657445564d436f6e74726163744164647265737328292c0a2020202020202020202020202020202020202020617267733a205b69645d2c0a20202020202020202020202020202020202020206761734c696d69743a2031353030303030302c0a202020202020202020202020202020202020202076616c75653a20302e300a20202020202020202020202020202020290a2020202020202020202020202920617321205b416e795374727563745d0a2020202020202020290a202020202020202061737365727428746f6b656e555249526573706f6e73652e6c656e677468203d3d20312c206d6573736167653a2022496e76616c696420726573706f6e7365206c656e67746822290a20202020202020206c657420746f6b656e5552493a20537472696e67203d20746f6b656e555249526573706f6e73655b305d2061732120537472696e670a20202020202020206c657420627269646765644e4654203c2d20637265617465204e4654280a2020202020202020202020206e616d653a2073656c662e6e616d652c0a20202020202020202020202073796d626f6c3a2073656c662e73796d626f6c2c0a20202020202020202020202065766d49443a2069642c0a2020202020202020202020207572693a20746f6b656e5552492c0a2020202020202020202020206d657461646174613a207b0a20202020202020202020202020202020224272696467656420426c6f636b223a2067657443757272656e74426c6f636b28292e6865696768742c0a2020202020202020202020202020202022427269646765642054696d657374616d70223a2067657443757272656e74426c6f636b28292e74696d657374616d700a2020202020202020202020207d0a2020202020202020290a202020202020202072657475726e203c2d20627269646765644e46540a202020207d0a0a202020202f2f20544f444f3a205265706c6163652077697468207632207374616e64617264206275726e696e67206d656368616e69736d2026206576656e740a202020206163636573732873656c66292066756e206275726e4e4654286e66743a2040",
            "2e4e465429207b0a202020202020202064657374726f79206e66740a202020207d0a0a20202020696e6974286e616d653a20537472696e672c2073796d626f6c3a20537472696e672c2065766d436f6e7472616374416464726573733a2045564d2e45564d4164647265737329207b0a202020202020202073656c662e65766d4e4654436f6e747261637441646472657373203d2065766d436f6e7472616374416464726573730a202020202020202073656c662e666c6f774e4654436f6e747261637441646472657373203d2073656c662e6163636f756e742e616464726573730a202020202020202073656c662e6e616d65203d206e616d650a202020202020202073656c662e73796d626f6c203d2073796d626f6c0a0a20202020202020202f2f20437265617465206120436f6c6c656374696f6e207265736f7572636520616e64207361766520697420746f2073746f726167650a20202020202020206c657420636f6c6c656374696f6e203c2d2063726561746520436f6c6c656374696f6e28290a20202020202020206c65742064656661756c7453746f7261676550617468203d20636f6c6c656374696f6e2e67657444656661756c7453746f72616765506174682829210a20202020202020206c65742064656661756c745075626c696350617468203d20636f6c6c656374696f6e2e67657444656661756c745075626c6963506174682829210a202020202020202073656c662e6163636f756e742e73746f726167652e73617665283c2d636f6c6c656374696f6e2c20746f3a2064656661756c7453746f7261676550617468290a0a202020202020202073656c662e6c6f636b65644e465454797065203d20547970653c40",
            "2e4e46543e28290a202020202020202073656c662e6c6f636b6572203c2d2073656c662e637265617465456d707479436f6c6c656374696f6e28290a202020207d0a7d0a"
        ]
    }
}
